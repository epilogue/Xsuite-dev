<?php
$this->title = 'Xprice/accueil';
$this->headTitle($this->title);

$this->headScript()->appendFile('/js/controllers/xprice/popup.js');
?>


<div class="contenu">
    <h2>Xprice</h2>
    <h3>Demande en ligne pour Prix Spéciaux</h3> 
    <table class="enum">
        <tr>
             <?php if($this->fonction == 5 || $this->fonction == 13 || $this->fonction ==10 || $this->fonction ==29){?>
            <th>Commercial</th>
        <?php } ?>
            <th>Numéro Workplace</th>
            <th>Tracking number</th>
            <th>Nom Client</th>
            <th>Date demande</th>
             <th>état validation</th>
        </tr>
    <?php  foreach($this->recapitulatif as $k=>$result){
        ?><tr>
            <?php if($this->fonction == 5 || $this->fonction == 13 || $this->fonction == 10 || $this->fonction ==29){?>
             <td><?php echo $result['nom_user'];?></td>
        <?php } ?>
            <td><?php echo $result['num_workplace_demande_xprice']; ?></td>
            <td><?php echo $result['tracking_number_demande_xprice']; ?></td>
            <td><?php echo $result['nom_client']; ?></td>
             <td><?php echo $result['date_demande_xprice']; ?></td>
        <?php if($result['etat_validation']=="validee" || $result['etat_validation']=="validée" || $result['etat_validation']=="enAttente"){ ?>
             <td>en cours</td><?php } else{ ?>
             <td><?php echo $result['etat_validation'];?></td>
        <?php }  ?>
             <td><a href="<?php echo $this->url(array("controller"=>"xprice","action"=>"consult","numwp"=>$result['num_workplace_demande_xprice']));?>" <button class="retour" id="historique-<?php echo $k; ?>">historique</button></a>
             </td>
              <?php if($this->fonction == 5 || $this->fonction ==29 ){?>
             <td><a href="<?php echo $this->url(array("controller"=>"xprice","action"=>"validatedbd","numwp"=>$result['num_workplace_demande_xprice']));?>" <button class="retour" id="validate-<?php echo $k; ?>">Valider</button></a></td>
        <?php } elseif($this->fonction == 13){?>
             <td><a href="<?php echo $this->url(array("controller"=>"xprice","action"=>"validatedirco","numwp"=>$result['num_workplace_demande_xprice']));?>" <button class="retour" id="validate-<?php echo $k; ?>">Valider</button></a></td>
        <?php } elseif( $this->fonction == 10 ){?>
             <td><a href="<?php echo $this->url(array("controller"=>"xprice","action"=>"validatechefregion","numwp"=>$result['num_workplace_demande_xprice']));?>" <button class="retour" id="validate-<?php echo $k; ?>">Valider</button></a></td>
        <?php } elseif($this->fonction == 32){?>
             <td><a href="<?php echo $this->url(array("controller"=>"xprice","action"=>"validatesupply","numwp"=>$result['num_workplace_demande_xprice']));?>" <button class="retour" id="validate-<?php echo $k; ?>">Valider</button></a></td>
        <?php }elseif($this->fonction == 23){?>
             <td><a href="<?php echo $this->url(array("controller"=>"xprice","action"=>"prixfobfr","numwp"=>$result['num_workplace_demande_xprice']));?>" <button class="retour" id="validate-<?php echo $k; ?>">Valider</button></a></td>
        <?php } ?>
</tr>
   <?php }?>
    </table>
</div>